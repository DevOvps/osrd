{
  "aspects": [
    "green",
    "yellow",
    "red"
  ],
  "operational_points": [
    {
      "id": "op.station_foo"
    },
    {
      "id": "op.station_bar"
    }
  ],
  "routes": [
    {
      "id": "rt.buffer_stop_a-C1",
      "switches_position": {},
      "tvd_sections": [
        "tvd.foo_a"
      ]
    },
    {
      "id": "rt.buffer_stop_b-C3",
      "switches_position": {},
      "tvd_sections": [
        "tvd.foo_b"
      ]
    },
    {
      "id": "rt.C1-S7",
      "switches_position": {
        "il.switch_foo": "RIGHT"
      },
      "tvd_sections": [
        "tvd.switch_foo",
        "tvd.track"
      ]
    },
    {
      "id": "rt.C3-S7",
      "switches_position": {
        "il.switch_foo": "LEFT"
      },
      "tvd_sections": [
        "tvd.switch_foo",
        "tvd.track"
      ]
    },
    {
      "id": "rt.S7-buffer_stop_c",
      "switches_position": {},
      "tvd_sections": [
        "tvd.bar_a"
      ]
    },
    {
      "id": "rt.buffer_stop_c-C2",
      "switches_position": {},
      "tvd_sections": [
        "tvd.bar_a"
      ]
    },
    {
      "id": "rt.C2-C6",
      "switches_position": {},
      "tvd_sections": [
        "tvd.track"
      ]
    },
    {
      "id": "rt.C6-buffer_stop_a",
      "switches_position": {
        "il.switch_foo": "RIGHT"
      },
      "tvd_sections": [
        "tvd.track",
        "tvd.foo_a"
      ]
    },
    {
      "id": "rt.C6-buffer_stop_b",
      "switches_position": {
        "il.switch_foo": "RIGHT"
      },
      "tvd_sections": [
        "tvd.track",
        "tvd.foo_b"
      ]
    }
  ],
  "script_functions": [
    {
      "function_name": "sncf_filter",
      "arguments": [
        {
          "type": "ASPECT_SET",
          "name": "aspects"
        }
      ],
      "return_type": "ASPECT_SET",
      "body": {
        "type": "condition",
        "if": {
          "type": "aspect_set_contains",
          "aspect_set": {
            "type": "argument_ref",
            "argument_name": "aspects"
          },
          "aspect": "RED"
        },
        "then": {
          "type": "aspect_set",
          "members": [
            {
              "aspect": "RED"
            }
          ]
        },
        "else": {
          "type": "condition",
          "if": {
            "type": "aspect_set_contains",
            "aspect_set": {
              "type": "argument_ref",
              "argument_name": "aspects"
            },
            "aspect": "YELLOW"
          },
          "then": {
            "type": "aspect_set",
            "members": [
              {
                "aspect": "YELLOW"
              }
            ]
          },
          "else": {
            "type": "argument_ref",
            "argument_name": "aspects"
          }
        }
      }
    },
    {
      "function_name": "bal3_line_signal",
      "arguments": [
        {
          "type": "SIGNAL",
          "name": "master_signal"
        },
        {
          "type": "ROUTE",
          "name": "route"
        }
      ],
      "return_type": "ASPECT_SET",
      "body": {
        "type": "call",
        "function": "sncf_filter",
        "arguments": [
          {
            "type": "aspect_set",
            "members": [
              {
                "aspect": "RED",
                "condition": {
                  "type": "route_has_state",
                  "route": {
                    "type": "argument_ref",
                    "argument_name": "route"
                  },
                  "state": "OCCUPIED"
                }
              },
              {
                "aspect": "YELLOW",
                "condition": {
                  "type": "signal_has_aspect",
                  "route": {
                    "type": "argument_ref",
                    "argument_name": "master_signal"
                  },
                  "aspect": "RED"
                }
              },
              {
                "aspect": "GREEN"
              }
            ]
          }
        ]
      }
    },
    {
      "function_name": "switch_bal3_signal",
      "arguments": [
        {
          "type": "SWITCH",
          "name": "switch"
        },
        {
          "type": "SIGNAL",
          "name": "left_master_signal"
        },
        {
          "type": "SIGNAL",
          "name": "right_master_signal"
        },
        {
          "type": "ROUTE",
          "name": "left_route"
        },
        {
          "type": "ROUTE",
          "name": "right_route"
        }
      ],
      "return_type": "ASPECT_SET",
      "body": {
        "type": "match",
        "expr": {
          "type": "argument_ref",
          "argument_name": "switch"
        },
        "branches": {
          "LEFT": {
            "type": "call",
            "function": "bal3_line_signal",
            "arguments": [
              {
                "type": "argument_ref",
                "argument_name": "left_master_signal"
              },
              {
                "type": "argument_ref",
                "argument_name": "left_route"
              }
            ]
          },
          "RIGHT": {
            "type": "call",
            "function": "bal3_line_signal",
            "arguments": [
              {
                "type": "argument_ref",
                "argument_name": "right_master_signal"
              },
              {
                "type": "argument_ref",
                "argument_name": "right_route"
              }
            ]
          }
        }
      }
    }
  ],
  "speed_sections": [
    {
      "id": "speedsection.mid_limit",
      "is_signalized": true,
      "speed": 16.666666666666668
    }
  ],
  "switches": [
    {
      "base": {
        "endpoint": "BEGIN",
        "section": "ne.micro.foo_to_bar"
      },
      "id": "switch_foo",
      "left": {
        "endpoint": "END",
        "section": "ne.micro.foo_b"
      },
      "right": {
        "endpoint": "END",
        "section": "ne.micro.foo_a"
      }
    }
  ],
  "track_section_links": [
    {
      "begin": {
        "endpoint": "END",
        "section": "ne.micro.foo_a"
      },
      "end": {
        "endpoint": "BEGIN",
        "section": "ne.micro.foo_to_bar"
      },
      "navigability": "BOTH"
    },
    {
      "begin": {
        "endpoint": "END",
        "section": "ne.micro.foo_b"
      },
      "end": {
        "endpoint": "BEGIN",
        "section": "ne.micro.foo_to_bar"
      },
      "navigability": "BOTH"
    },
    {
      "begin": {
        "endpoint": "END",
        "section": "ne.micro.foo_to_bar"
      },
      "end": {
        "endpoint": "BEGIN",
        "section": "ne.micro.bar_a"
      },
      "navigability": "BOTH"
    }
  ],
  "track_sections": [
    {
      "buffer_stops": [
        {
          "applicable_directions": "REVERSE",
          "id": "buf_stop_b",
          "position": 0
        }
      ],
      "id": "ne.micro.foo_b",
      "length": 200,
      "operational_points": [
        {
          "begin": 100,
          "end": 100,
          "ref": "op.station_foo"
        }
      ],
      "signals": [],
      "speed_sections": [],
      "train_detectors": [
        {
          "id": "tde.foo_b-switch_foo",
          "position": 175
        }
      ]
    },
    {
      "buffer_stops": [],
      "id": "ne.micro.foo_to_bar",
      "length": 10000,
      "operational_points": [],
      "signals": [
        {
          "id": "signal.foo_to_bar.1",
          "position": 25,
          "navigability": "BOTH",
          "expr": {
            "type": "call",
            "function": "bal3_line_signal",
            "arguments": [
              {
                "type": "signal",
                "signal": "signal.foo_to_bar.2"
              },
              {
                "type": "route",
                "signal": "ne.micro.foo_to_bar"
              }
            ]
          }
        },
        {
          "id": "signal.foo_to_bar.2",
          "position": 75,
          "navigability": "BOTH",
          "expr": {
            "type": "match",
            "expr": {
              "type": "route",
              "route": "ne.micro.bar_a"
            },
            "branches": {
              "FREE": {
                "type": "aspect_set",
                "members": [
                  {
                    "aspect": "GREEN"
                  }
                ]
              },
              "RESERVED": {
                "type": "aspect_set",
                "members": [
                  {
                    "aspect": "RED"
                  }
                ]
              },
              "OCCUPIED": {
                "type": "aspect_set",
                "members": [
                  {
                    "aspect": "RED"
                  }
                ]
              }
            }
          }
        }
      ],
      "speed_sections": [
        {
          "applicable_directions": "BOTH",
          "begin": 2000,
          "end": 8000,
          "ref": "speedsection.mid_limit"
        }
      ],
      "train_detectors": [
        {
          "id": "tde.switch_foo-track",
          "position": 25
        }
      ]
    },
    {
      "buffer_stops": [
        {
          "applicable_directions": "REVERSE",
          "id": "buf_stop_a",
          "position": 0
        }
      ],
      "id": "ne.micro.foo_a",
      "length": 200,
      "operational_points": [
        {
          "begin": 100,
          "end": 100,
          "ref": "op.station_foo"
        }
      ],
      "signals": [],
      "speed_sections": [],
      "train_detectors": [
        {
          "id": "tde.foo_a-switch_foo",
          "position": 175
        }
      ]
    },
    {
      "buffer_stops": [
        {
          "applicable_directions": "NORMAL",
          "id": "buf_stop_c",
          "position": 200
        }
      ],
      "id": "ne.micro.bar_a",
      "length": 200,
      "operational_points": [
        {
          "begin": 100,
          "end": 100,
          "ref": "op.station_bar"
        }
      ],
      "signals": [],
      "speed_sections": [],
      "train_detectors": [
        {
          "id": "tde.track-bar",
          "position": 0
        }
      ]
    }
  ],
  "tvd_sections": [
    {
      "buffer_stops": [
        "buffer_stop_a"
      ],
      "id": "tvd.foo_a",
      "is_berthing_track": true,
      "train_detectors": [
        "tde.foo_a-switch_foo"
      ]
    },
    {
      "buffer_stops": [
        "buffer_stop_b"
      ],
      "id": "tvd.foo_b",
      "is_berthing_track": true,
      "train_detectors": [
        "tde.foo_b-switch_foo"
      ]
    },
    {
      "buffer_stops": [],
      "id": "tvd.switch_foo",
      "is_berthing_track": false,
      "train_detectors": [
        "tde.foo_b-switch_foo",
        "tde.foo_a-switch_foo",
        "tde.switch_foo-track"
      ]
    },
    {
      "buffer_stops": [],
      "id": "tvd.track",
      "is_berthing_track": false,
      "train_detectors": [
        "tde.track-bar",
        "tde.switch_foo-track"
      ]
    },
    {
      "buffer_stops": [
        "buffer_stop_c"
      ],
      "id": "tvd.bar_a",
      "is_berthing_track": true,
      "train_detectors": [
        "tde.track-bar"
      ]
    }
  ],
  "version": 1
}
